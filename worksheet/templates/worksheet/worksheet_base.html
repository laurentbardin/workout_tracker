{% extends 'worksheet/base.html' %}

{% load static %}

{% block content %}

{% if worksheet is None %}
<h1>No workout for {{ date }}.</h1>
<p><a href="{% url 'worksheet:index' %}">Go back</a></p>
{% else %}
<h1>Workout for {{ worksheet.date }}: {{ worksheet.workout }}</h1>
{% if worksheet.done %}
<p>Completed in {{ worksheet.get_duration }}</p>
{% else %}
<h2><span id="clock" class="hidden">0:00:00</span></h2>
{% endif %}
<section class="worksheet {{ worksheet.get_status }}">
    <div class="exercise header">Exercise</div>
    <div class="reps header">Reps</div>
    <div class="weight header">Weight (kg)</div>
    {% if results.0.previous %}
    <div class="reps previous header">Previous reps</div>
    <div class="weight previous header">Previous weight (kg)</div>
    {% endif %}

    {% block workout_results %}{% endblock %}
</section>

{% block workout_form %}
{% if not worksheet.done %}
<form action="{% url 'worksheet:close' worksheet.id %}" method="POST">
    {% csrf_token %}
    <input type="submit" value="Close">
</form>
{% endif %}
{% endblock %}

{% endif %}

{% endblock content %}

{% block javascript %}
    {{ block.super }}
    <script src="{% static 'worksheet/js/htmx.min.js' %}"></script>
    <script src="{% static 'worksheet/js/worksheet.js' %}"></script>
    {% if not worksheet.done %}
    <script type="text/javascript">
        htmx.onLoad(function(elt) {
            let fn = updateClock('#clock', '{{ worksheet.started_at|date:"c" }}');
            fn();
            htmx.removeClass('#clock', 'hidden');
            setInterval(fn, 1000);
        });
    </script>
    {% endif %}
{% endblock %}
